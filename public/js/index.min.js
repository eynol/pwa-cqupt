var storeTool={_prefix:"CQUPT",_sid:"userSid",setUserList:function(t){var e="";"string"==typeof t?e=t:"object"==typeof t&&(e=JSON.stringify(t)),localStorage.setItem(this._prefix+"UserList",e)},getUserList:function(){var t=localStorage.getItem(this._prefix+"UserList");return JSON.parse(t)},signout:function(){localStorage.removeItem(this._prefix+"UserList")}},Listener=new Vue;Vue.component("login",{template:"#tpl-login",props:[],data:function(){return{fakeId:void 0}},methods:{fakeIdKeyDown:function(t){13==t.keyCode&&this.enterApp()},enterApp:function(t){var e=this;/\d{10}/.test(this.fakeId)?getListById(this.fakeId,function(t,n){t||(0===n.code?(n.id=e.fakeId,Listener.$emit("success-login",n)):e.error(n.msg))},{root:!0}):this.error("请输入正确的学号(不是一卡通号)")},error:function(t){setTimeout(function(){},4)}}}),Vue.component("content-day",{name:"content-day",template:"#tpl-content-day",props:["list","today","tomorrow","tomorrowOption2","lastUpdateTime"],data:function(){return{fakeId:void 0}},computed:{updateTime:function(){return new Date(Number(this.lastUpdateTime))},todayList:function(){var t=this,e=[];return this.list.forEach(function(n){n.weekend&&n.weekend.indexOf(t.today.weekendPast)!==-1&&n.day===t.today.todayDay&&e.push(n)}),e.sort(sortClassList)},tomorrowList:function(){var t=this,e=[];return this.list.forEach(function(n){n.weekend&&n.weekend.indexOf(t.tomorrow.weekendPast)!==-1&&n.day===t.tomorrow.todayDay&&e.push(n)}),e.sort(sortClassList)}},created:function(){var t=this,e=function(){var e=new Date,n=e.getHours(),i=e.getMinutes(),o=new Date(e.getFullYear(),e.getMonth(),e.getDate(),n,i+20),s=o.getHours(),a=o.getMinutes();t.todayList.forEach(function(t){if(t.whichClass){var e=getRowIndex(t.whichClass.substring(1,3));isHavingClass(e,n,i,!0)||isHavingClass(e,s,a,!0)?t.activated=!0:t.activated=!1}})};e(),setInterval(e,6e4)},methods:{}}),Vue.component("content-table",{name:"content-table",template:"#tpl-content-table",props:["list","today","lastUpdateTime"],computed:{updateTime:function(){return new Date(Number(this.lastUpdateTime))},table:function(){var t={hasWeekend:!1,data:[[[],[],[],[],[],[],[]],[[],[],[],[],[],[],[]],[[],[],[],[],[],[],[]],[[],[],[],[],[],[],[]],[[],[],[],[],[],[],[]],[[],[],[],[],[],[],[]]]};return this.list.forEach(function(e){var n=getRowIndex(e.whichClass&&e.whichClass.substring(1,3)),i=getColIndex(e.day);/6|0/.test(e.day)&&(t.hasWeekend=!0),t.data[n][i].push(e)}),t}},methods:{}}),Vue.component("content-setting",{name:"content-setting",template:"#tpl-content-setting",props:["sid"],data:function(){return{urlScreenShot:"http://pluscdn.heitaov.cn/Screenrecord-2017-03-12-23-30-39-643.mp4",isLoading:!1,config:{show:!1,openFirst:!1,first:20,openSecond:!1,second:5,openThird:!1,third:0}}},created:function(){this.$watch("config.show",function(t){var e=this;return 1==t&&"granted"!==Notification.permission&&Notification.requestPermission().then(function(t){"granted"!=t&&(e.config.show=!1)}),!1}),this.initConfig()},methods:{updateList:function(){getListById(this.sid,function(t,e){t||Listener.$emit("success-login",e)},{root:!0})},signout:function(){Listener.$emit("signout")},pushtest:function(){var t=new MessageChannel;navigator.serviceWorker.controller.postMessage({action:"test"},[t.port2]),t.port1.onmessage=function(t){}},initConfig:function(){var t=new MessageChannel,e=this;navigator.serviceWorker.controller.postMessage({action:"getconfig"},[t.port2]),t.port1.onmessage=function(t){var n=void 0;e.config=t.data,e.$watch("config",function(t,i){(""==t.first||t.first<0)&&(t.first=0),(""==t.second||t.second<0)&&(t.second=0),(""==t.third||t.third<0)&&(t.third=0),n&&clearTimeout(n),n=setTimeout(function(){e.saveConfig(),clearTimeout(n)},1500)},{deep:!0})}},saveConfig:function(){var t=new MessageChannel;navigator.serviceWorker.controller.postMessage({action:"saveconfig",data:this.config},[t.port2]),t.port1.onmessage=function(t){t.data.code}}}}),Vue.component("main-panel",{template:"#tpl-main-panel",props:["sid","list","today","tomorrow","lastUpdateTime"],data:function(){return{tab:"day",isLoading:!1}},components:{day:Vue.component("content-day"),week:Vue.component("content-table"),setting:Vue.component("content-setting")},methods:{navTo:function(t){this.tab=t}}});var app=new Vue({el:"#app",data:{id:void 0,originList:[],currentView:"",todayOption:{},tomorrowOption:{},lastRequestTime:"1",tab:"day"},created:function(){_this=this,Listener.$on("success-login",function(t){_this.login(t)}),Listener.$on("signout",function(){_this.signout()}),Listener.$on("DayDown",function(){_this.newDay()});var t=storeTool.getUserList();if(t){var e=t.id,n=t.list,i=t.time;this.id=e,this.originList=n||[],this.lastRequestTime=i,this.currentView="main-panel"}else this.currentView="login"},beforeMount:function(){this.newDay(),this.updateThisWeek()},beforeUpdate:function(){this.updateThisWeek()},components:{login:Vue.component("login"),"main-panel":Vue.component("main-panel")},computed:{hasLogin:function(){return!!this.id}},methods:{login:function(t){this.id=Number(t.id),this.lastRequestTime=t.time,this.originList=t.list,this.currentView="main-panel",storeTool.setUserList(t)},newDay:function(){var t=new Date;this.todayOption=doTimeCount(t),this.tomorrowOption=doTimeCount(new Date(t.getFullYear(),t.getMonth(),t.getDate()+1))},signout:function(){this.id=void 0,this.originList=[],this.currentView="login",storeTool.signout()},updateThisWeek:function(){var t=this;this.originList.forEach(function(e){e.thisWeek=!(!e.weekend||e.weekend.indexOf(t.todayOption.weekendPast)===-1)})}}});setInterval(function(){var t=(new Date).getDay();return function(){var e=new Date,n=(e.getHours(),e.getMinutes(),e.getDay());n!=t&&(setTimeout(function(){Listener.$emit("DayDown")},4),t=n)}}(),1e4);var detector={serviceWorker:"serviceWorker"in navigator,promise:"Promise"in window,cache:"Cache"in window,indexedDB:"indexedDB"in window,nothin:"nothin"in window};"serviceWorker"in navigator&&(navigator.serviceWorker.register("./sw.js"),navigator.serviceWorker.ready.then(function(t){}));